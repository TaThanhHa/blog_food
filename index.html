<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Blog Demo</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-image: linear-gradient(red, yellow);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navbar */
        .navbar {
            background-color: #ff6f61;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
        }

        .navbar .nav-links a {
            color: #fff;
            text-decoration: none;
            margin-left: 20px;
            transition: color 0.3s;
        }

        .navbar .nav-links a:hover {
            color: #ffd1c1;
        }

        /* Hero Section */
        .hero-section {
            background: url('images/hero-bg.jpg') no-repeat center center/cover;
            color: #fff;
            text-align: center;
            padding: 100px 20px;
        }

        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .hero-section p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .hero-section .user-greeting {
            font-size: 1.5rem;
            margin-top: 20px;
        }

        /* About Section */
        .about-section {
            text-align: center;
            margin: 50px 0;
        }

        .about-section img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 20px;
        }

        /* Form Sections */
        .login-section, .signup-section, .post-blog-section {
            background-color: #fff;
            padding: 50px 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Buttons */
        .btn-primary {
            background-color: #ff6f61;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #ff8c85;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .hero-section, .login-section, .signup-section, .post-blog-section {
            animation: fadeIn 1s ease-in-out;
        }

        /* Post Styles */
        .post {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .post img {
            display: block;
            margin: 0 auto 20px; /* Điều chỉnh khoảng cách dưới ảnh */
            max-width: 100%;
            border-radius: 10px; /* Bo góc cho ảnh */
        }

        .post h4 {
            margin-top: 0;
            font-size: 1.5rem;
        }

        .post p {
            font-size: 1rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">Foodie for Goodies</div>
            <div class="nav-links">
                <a href="#home">Home</a>
                <a href="#about">About</a>
                <a href="#login">Login</a>
                <a href="#signup">Sign Up</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="home" class="hero-section">
        <div class="container">
            <h1>Welcome to Foodie Bliss</h1>
            <p>Explore delicious recipes and share your own!</p>
            <div class="user-greeting hidden">Hello, <span id="username-display"></span>!</div>
        </div>
    </header>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <h2>About Us</h2>
            <p>Foodie Bliss is your go-to platform for exploring and sharing recipes that inspire creativity in the kitchen.</p>
            <img src="https://www.tastingtable.com/img/gallery/20-delicious-indian-dishes-you-have-to-try-at-least-once/intro-1645057933.jpg" alt="Beautifully plated dish">
        </div>
    </section>

    <!-- Login Section -->
    <section id="login" class="login-section hidden">
        <div class="container">
            <h2>Login</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
        </div>
    </section>

    <!-- Sign Up Section -->
    <section id="signup" class="signup-section hidden">
        <div class="container">
            <h2>Sign Up</h2>
            <form id="signup-form">
                <div class="form-group">
                    <label for="new-username">Username</label>
                    <input type="text" id="new-username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="new-password">Password</label>
                    <input type="password" id="new-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn-primary">Sign Up</button>
            </form>
        </div>
    </section>

    <!-- Post Blog Section -->
    <section id="post-blog" class="post-blog-section hidden">
        <div class="container">
            <h2>Create Your Blog Post</h2>
            <form id="post-blog-form">
                <div class="form-group">
                    <label for="post-title">Post Title</label>
                    <input type="text" id="post-title" placeholder="Enter the post title" required>
                </div>
                <div class="form-group">
                    <label for="post-image">Feature Image</label>
                    <input type="file" id="post-image" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="post-content">Content</label>
                    <textarea id="post-content" rows="6" placeholder="Write your post content here..." required></textarea>
                </div>
                <button type="submit" class="btn-primary">Publish Post</button>
            </form>
            <div id="posts-container"></div> <!-- Thêm container để chứa các bài đăng -->
        </div>
    </section>
	
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
		import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
		import { getDatabase, ref, set, get, child, push } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

		// Firebase configuration
		const firebaseConfig = {
			apiKey: "AIzaSyDU1k9woN_CxTLDhi38S15HyimANe8WweA",
			authDomain: "laptrinhoop-862da.firebaseapp.com",
			projectId: "laptrinhoop-862da",
			storageBucket: "laptrinhoop-862da.firebasestorage.app",
			messagingSenderId: "793152969345",
			appId: "1:793152969345:web:5bc970ed39339703438b80"
		};

		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
		const database = getDatabase(app);

		// Upload image to Imgur and get URL
		async function uploadImageToImgur(imageFile) {
			const clientId = '554e9714e25fa81';
			const formData = new FormData();
			formData.append("image", imageFile);

			const response = await fetch("https://api.imgur.com/3/image", {
				method: "POST",
				headers: {
					Authorization: `Client-ID ${clientId}`
				},
				body: formData
			});

			const data = await response.json();
			if (data.success) {
				return data.data.link;
			} else {
				throw new Error("Failed to upload image to Imgur");
			}
		}

		let username = ''; // Thêm biến username toàn cục

		// Hàm lấy và hiển thị các bài đăng của người dùng
		function displayUserPosts() {
			const userPostsRef = ref(database, `users/${username}/posts`);
			const postsContainer = document.getElementById('posts-container');
			postsContainer.innerHTML = ''; // Clear the container

			get(userPostsRef).then((snapshot) => {
				if (snapshot.exists()) {
					const posts = snapshot.val();
					for (const postId in posts) {
						const post = posts[postId];
						const postElement = document.createElement('div');
						postElement.classList.add('post');

						const postTitle = document.createElement('h4');
						postTitle.textContent = post.title;
						postElement.appendChild(postTitle);

						if (post.imageUrl) {
							const postImage = document.createElement('img');
							postImage.src = post.imageUrl;
							postImage.alt = post.title;
							postImage.style.maxWidth = '100%'; // Điều chỉnh kích thước ảnh
							postElement.appendChild(postImage);
						}

						const postContent = document.createElement('p');
						postContent.textContent = post.content;
						postElement.appendChild(postContent);

						postsContainer.appendChild(postElement);
					}
				} else {
					console.log('No posts available.');
				}
			}).catch((error) => {
				console.error("Failed to fetch user posts: ", error);
				alert("Failed to fetch user posts: " + error.message);
			});
		}

		// Handle Login
		const loginForm = document.getElementById('login-form');
		loginForm.addEventListener('submit', function (event) {
			event.preventDefault();
			username = document.getElementById('username').value; // Cập nhật biến username
			const password = document.getElementById('password').value;

			const dbRef = ref(database);

			get(child(dbRef, `users/${username}`)).then((snapshot) => {
				if (snapshot.exists()) {
					const userData = snapshot.val();
					if (userData.password === password) {
						alert('Login successful!');
						// Navigate to post blog section
						showSection(document.getElementById('post-blog'));
						// Update and show the user greeting
						document.getElementById('username-display').textContent = username;
						document.querySelector('.user-greeting').classList.remove('hidden');
						displayUserPosts(); // Hiển thị các bài đăng của người dùng
					} else {
						alert('Invalid password.');
					}
				} else {
					alert('No user found with this username.');
				}
			}).catch((error) => {
				console.error(error);
			});
		});

		// Handle Sign Up
		const signupForm = document.getElementById('signup-form');
		signupForm.addEventListener('submit', function (event) {
			event.preventDefault();
			const newUsername = document.getElementById('new-username').value;
			const newPassword = document.getElementById('new-password').value;

			set(ref(database, 'users/' + newUsername), {
				password: newPassword
			}).then(() => {
				alert('Sign up successful! Please log in.');
				// Navigate to login section
				document.querySelector('.nav-links a[href="#login"]').click();
			}).catch((error) => {
				console.error(error);
				alert('Sign up failed: ' + error.message);
			});
		});

		// Handle Publish Post
		const postBlogForm = document.getElementById('post-blog-form');
		postBlogForm.addEventListener('submit', async function (event) {
			event.preventDefault();
			const postTitle = document.getElementById('post-title').value;
			const postContent = document.getElementById('post-content').value;
			const postImage = document.getElementById('post-image').files[0];

			const userPostsRef = ref(database, `users/${username}/posts`);
			
			// Kiểm tra số lượng bài viết hiện tại
			get(userPostsRef).then(async (snapshot) => {
				let postCount = 0;
				if (snapshot.exists()) {
					postCount = Object.keys(snapshot.val()).length;
				}

				const postId = `post${postCount + 1}`;
				const postData = {
					title: postTitle,
					content: postContent
				};

				if (postImage) {
					try {
						const imageUrl = await uploadImageToImgur(postImage);
						postData.imageUrl = imageUrl;
					} catch (error) {
						console.error("Failed to upload image: ", error);
						alert("Failed to upload image: " + error.message);
						return;
					}
				}

				// Lưu bài viết vào Firebase
				set(ref(database, `users/${username}/posts/${postId}`), postData)
					.then(() => {
						alert('Post published successfully!');
						displayUserPosts(); // Hiển thị lại các bài đăng của người dùng
						
						// Đặt lại các trường nhập liệu
						document.getElementById('post-title').value = '';
						document.getElementById('post-content').value = '';
						document.getElementById('post-image').value = null;
					})
					.catch((error) => {
						console.error('Failed to publish post: ' + error.message);
						alert('Failed to publish post: ' + error.message);
					});
			}).catch((error) => {
				console.error("Failed to fetch user posts: ", error);
				alert("Failed to fetch user posts: " + error.message);
			});
		});


		// Function to show/hide sections
		function showSection(section) {
			const sections = document.querySelectorAll('section');
			sections.forEach(sec => sec.classList.add('hidden'));
			section.classList.remove('hidden');
		}

		// Event listeners for navigation links
		document.querySelector('.nav-links a[href="#login"]').addEventListener('click', function () {
			showSection(document.getElementById('login'));
		});

		document.querySelector('.nav-links a[href="#signup"]').addEventListener('click', function () {
			showSection(document.getElementById('signup'));
		});
	</script>


</body>
</html>
